<!DOCTYPE HTML>
  <head>
    <title>转换</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">
  </head>
  <body>
  <div class="container">
    <div class="div-font">
      <form id="dto">
        <div class="row">
          <div class="col-xs-12 col-md-8">
            <textarea id="before" name="before" rows="5" cols="30"></textarea>
          </div>
          <div class="col-xs-6 col-md-4">
            <button id="transform" type="button" class="btn-info" style="font-size: 3rem">转换</button>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-18 col-md-12">
            <span style="font-size: 1rem;">使用短链接</span>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-12 col-md-8">
            <textarea id="copy-target" name="after" readonly="readonly" rows="5" cols="30"></textarea>
          </div>
          <div class="col-xs-6 col-md-4">
            <button id="copy-btn" type="button" class="btn btn-danger copy-btn" data-clipboard-target="#copy-target" style="font-size: 3rem">点我复制</button>
          </div>
        </div>

        <table style="width: 100%">
          <tr>
            <td width="90%">
              <textarea id="before" name="before" rows="5" cols="30">
</textarea>
            </td>
            <td width="10%">
              <button id="transform" type="button" class="btn-info" style="font-size: 3rem">转换</button>
            </td>
          </tr>
          <tr>
            <td colspan="2">
              <table width="100%">
                <tr>
                  <td>
                    <span style="font-size: 1rem;">使用短链接</span>
                    <input id="shortUrl1" name="shortUrl" type="checkbox" value="true" checked="checked"/><input type="hidden" name="_shortUrl" value="on"/>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
          <tr>
            <td>
              <textarea id="copy-target" name="after" readonly="readonly" rows="5" cols="30">
</textarea>
            </td>
            <td>
              <button id="copy-btn" type="button" class="btn btn-danger copy-btn" data-clipboard-target="#copy-target" style="font-size: 3rem">点我复制</button>
            </td>
          </tr>          
        </table>
      </form>
    </div>
  </div>
  <script src="js/jquery-3.2.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/clipboard.min.js"></script>
  <script>
      var url_short;
      $(document).ready(function() {
          $('#transform').click(function () {
              var longStr = $('#before').val();
              var shortStr = longStr.split('￥');

              $.getJSON("sever.php",{item_id: shortStr[1]},function (json) {
                  url_short = json.urls[0].url_short;
                  url_long = json.urls[0].url_long;
                  if($('#shortUrl1').is(":checked")){
                      $('#copy-target').val("￥" + shortStr[1] +"￥\n"
                              + url_short + "\n"
                              + "↑苹果用户直接复制此消息打开手机淘宝，安卓用户点击链接复制淘口令");
                  }else {
                      $('#copy-target').val("￥" + shortStr[1] +"￥\n"
                              +url_long +"\n"
                              + "↑苹果用户直接复制此消息打开手机淘宝，安卓用户点击链接复制淘口令");
                  }
              });
          });
      });
  </script>
  <script>
      var clipboard = new Clipboard('#copy-btn');
      var interval = undefined;
      clipboard.on('success', function (e) {
          //          var btnTitle = $('#copy-btn').html();
          $('#copy-btn').html("已复制");
          if (interval != undefined) {
              clearInterval(interval);
          }

          interval = setInterval(function () {
              $('#copy-btn').html('点我复制');
          }, 3000);
      });
      clipboard.on('error', function (e) {
      });
  </script>


  </body>
</html>
